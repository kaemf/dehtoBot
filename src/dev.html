<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
      function checkAvailabilityForLesson(timeInputed, date, time, duration, part, newDuration) {
        duration = duration * 60000;
        let free = false,
          busyBy = '';

        switch(part){
          case "part_1":
            const endTime = new Date(new Date(`${date}T${time}`).getTime() + duration),
              startTime = new Date(new Date(`${date}T${time}`).getTime() - 1800000),
              lessonTime = new Date(`${date}T${time}`),
              timeInputted_ =  new Date(`${date}T${timeInputed}`);

            if (lessonTime <= timeInputted_){
              console.log(`(P1) Trigger on: lessonTime <= timeInputted_`)
              if (endTime <= timeInputted_){
                console.log(`(P1) Trigger on: endTime <= timeInputted_`)
                free = false;
              }
              else{
                free = true;
                console.log(`(P1) Trigger on like else: endTime <= timeInputted_`)
                busyBy = 'Alexa';
              }
            }
            else if (lessonTime >= timeInputted_){
              console.log(`(P1) Trigger on: lessonTime >= timeInputted_`)
              if (startTime >= timeInputted_){
                console.log(`(P1) Trigger on: startTime >= timeInputted_`)
                free = false;
              }
              else{
                console.log(`(P1) Trigger on like else: startTime >= timeInputted_`)
                free = true;
                busyBy = 'Alexa';
              }
            }
            if (free){
              console.warn(`(P1) Busy: ${busyBy}`);
              console.log(`(P1) Дата и время занятия: ${date} ${time}, \n\n${timeInputted_}`);
              console.log(`(P1) Сколько идет занятие: ${duration / 60000}`);
              console.log(`(P1) EndTime Когда заканчивается занятие (+duration): ${endTime}`);
              console.log(`(P1) StartTime Время начала занятия (-30): ${startTime}`);
            }
            else{
              console.warn(`(P1) No Busy`);
              console.log(`(P1) Дата и время занятия: ${date} ${time}, \n\n${timeInputted_}`);
              console.log(`(P1) Сколько идет занятие: ${duration / 60000}`);
              console.log(`(P1) EndTime Когда заканчивается занятие (+duration): ${endTime}`);
              console.log(`(P1) StartTime Время начала занятия (-30): ${startTime}`);
            }
            break;

          case "part_2":
            if (newDuration === undefined) throw new Error('newDuration is undefined');
            const newDuration_ = newDuration * 60000,
              _endTime = new Date(new Date(`${date}T${time}`).getTime() + duration),
              _startTime = new Date(new Date(`${date}T${time}`).getTime() - newDuration_),
              _lessonTime = new Date(`${date}T${time}`),
              _timeInputted_ =  new Date(`${date}T${timeInputed}`);

            if (_lessonTime <= _timeInputted_){
              console.log(`(P2) Trigger on: lessonTime <= timeInputted_`)
              if (_endTime <= _timeInputted_){
                console.log(`(P2) Trigger on: endTime <= timeInputted_`)
                free = false;
              }
              else{
                free = true;
                console.log(`(P2) Trigger on like else: endTime <= timeInputted_`)
                busyBy = 'Alexa';
              }
            }
            else if (_lessonTime >= _timeInputted_){
              console.log(`(P2) Trigger on: lessonTime >= timeInputted_`)
              if (_startTime >= _timeInputted_){
                console.log(`(P2) Trigger on: startTime >= timeInputted_`)
                free = false;
              }
              else{
                console.log(`(P2) Trigger on like else: startTime >= timeInputted_`)
                free = true;
                busyBy = 'Alexa';
              }
            }
            if (free){
              console.warn(`(P2) Busy: ${busyBy}`);
              console.log(`(P2) Дата и время занятия: ${date} ${time}, \n\n${_timeInputted_}`);
              console.log(`(P2) Сколько идет занятие: ${duration / 60000}`);
              console.log(`(P2) EndTime Когда заканчивается занятие (+duration): ${_endTime}`);
              console.log(`(P2) StartTime Время начала занятия (-30): ${_startTime}`);
            }
            else{
              console.warn(`(P2) No Busy`);
              console.log(`(P2) Дата и время занятия: ${date} ${time}, \n\n${_timeInputted_}`);
              console.log(`(P2) Сколько идет занятие: ${duration / 60000}`);
              console.log(`(P2) EndTime Когда заканчивается занятие (+duration): ${_endTime}`);
              console.log(`(P2) StartTime Время начала занятия (-30): ${_startTime}`);
            }
            break;

          default:
            throw new Error('Wrong part parametr');
        }
      }

      const timeInputed = '15:30',
        newDuration = 60;

      const date = '2024-05-19',
        time = '16:00',
        duration = 90;

      checkAvailabilityForLesson(timeInputed, date, time, duration, 'part_2', newDuration);
    </script>
</body>
</html>